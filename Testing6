apply plugin: 'org.springframework.boot'

sourceCompatibility = JavaVersion.VERSION_11

def jarBaseName= 'ams-service-middleware'
def distributionFolder = 'ams-service-middleware'
def configFiles = ['application.properties','logback.xml','ams-service-middleware.sh','ams-service-middleware.service'] as Set

bootJar {
    baseName = jarBaseName
    exclude configFiles
}

task copyFilesToPackage(type: Copy) {
    from('src/main/resources') {
        include configFiles
    }
    from 'build/libs/'+jarBaseName+'.jar'
    into 'build/'+distributionFolder
}

task zipPackage(type: Zip, dependsOn: 'copyFilesToPackage') {
    from 'build/'+distributionFolder
    baseName distributionFolder
}

build.dependsOn zipPackage
zipPackage.mustRunAfter check

dependencies {

    compile project(":altamides-app-libraries-altamides-v3-commons")
    compile project(":altamides-app-libraries-altamides-v3-preference")

    compile("org.springframework.boot:spring-boot-starter-web:$versionSpringBootStarter") {
        exclude module: "spring-boot-starter-tomcat"
    }
    compile("org.springframework.boot:spring-boot-starter-jetty:$versionSpringBootStarter")
    compile("org.springframework.boot:spring-boot-starter-actuator:$versionSpringBootStarter")
    compile("org.springframework.boot:spring-boot-legacy:$versionSpringBootLegacy")

//    runtime 'antlr:antlr:2.7.6'
//    runtime 'aopalliance:aopalliance:1.0'
    runtime("commons-beanutils:commons-beanutils:$versionCommonsBeanutils")
    runtime("commons-codec:commons-codec:$versionCommonsCodec")
    runtime("org.apache.commons:commons-collections4:$versionCommonsCollections4")
    runtime("dom4j:dom4j:$versionDom4j")
    runtime("org.ehcache:ehcache:$versionEhcache")
//    compile(group: 'org.hibernate', name: 'hibernate-entitymanager', version: '3.4.0.GA'){
//        transitive = false
//    }
    compile("org.hibernate.javax.persistence:hibernate-jpa-2.1-api:$versionHibernateJpa21Api")
    compile("org.hibernate:hibernate-core:$versionHibernateCore")
    //runtime(group: 'javassist', name: 'javassist', version: '3.12.0.GA')
    //compile(group: 'org.jboss.spec.javax.ejb', name: 'jboss-ejb-api_3.1_spec', version: '1.0.1.Final')
    //compile(group: 'org.jboss.spec.javax.jms', name: 'jboss-jms-api_1.1_spec', version: '1.0.0.Final')
    //runtime(group: 'org.slf4j', name: 'jcl-over-slf4j', version: '1.6.4')
    compile("ch.qos.logback:logback-classic:$versionLogback")
    compile("ch.qos.logback:logback-core:$versionLogback")
    compile("mysql:mysql-connector-java:$versionMysqlConnectorJava")
    compile("org.slf4j:slf4j-api:$versionSlf4j")
    //runtime(group: 'com.microsoft', name: 'sqljdbc-sqlserver', version: '3.0')
    //providedCompile 'javax.servlet:servlet-api:2.5'
    compile("org.springframework:spring-aop:$versionSpring")
    compile("org.springframework:spring-aspects:$versionSpring")
    compile("org.springframework:spring-tx:$versionSpring")
    compile("org.springframework:spring-jdbc:$versionSpring") {
        exclude group: 'org.springframework', module: 'org.springframework.transaction'
    }
    compile("org.springframework:spring-jms:$versionSpring")
    compile("org.springframework:spring-orm:$versionSpring")
    compile("org.springframework:spring-context-support:$versionSpring")

    compile("org.springframework:spring-webmvc:$versionSpring")
    compile("javax.servlet:javax.servlet-api:$versionJavaxServletApi")
    compile("org.quartz-scheduler:quartz:$versionQuartz")
    compile("com.zaxxer:HikariCP:$versionHikaricp")
    //testCompile 'junit:junit:4.10'
	compile("com.jolbox:bonecp:$versionBonecp")
    compile("com.rabbitmq.jms:rabbitmq-jms:1.11.2")
    compile("com.rabbitmq:amqp-client:$versionAmqpClient")
    compile("com.sun.messaging.mq:fscontext:4.6-b01")
    testCompile group: 'com.sun.messaging.mq', name: 'fscontext', version: '4.6-b01'
    compile("org.junit.jupiter:junit-jupiter-api:$versionJunitJupiterApi")
    testCompile("org.junit.jupiter:junit-jupiter-api:$versionJunitJupiterApi")

}

test { systemProperties 'property': 'value' }
