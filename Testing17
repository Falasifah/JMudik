SELECT ID,USER_ID,TOKEN,DESTINATION_HP,DESTINATION_TYPE,QUERY_METHOD,INTERROGATION_TYPE,IP,PWD_SEND,ALIAS_NAME,INTERVALS,START_DATE_SERVER,END_DATE_SERVER,START_TIME,END_TIME,RUN_SCHEDULE,FLAG_STATUS,SUN,MON,TUE,WED,THU,FRI,SAT,ENTRY_DATE,SOURCE,SMS_NODE,VEHICLE_ID,LOCKED,SCHEDULE_GROUP,PSL_ENABLED,PSL_PROVIDER,DELETE_FLAG,RUNNING_SCHEDULE_SID,SERVER_NAME,IF('2019-06-13 10:10' BETWEEN START_DATE_SERVER AND END_DATE_SERVER ,1,0) AS IN_PERIOD 
FROM LOCATION_SINGLE_USE.RUNNING_SCHEDULE 
WHERE  ('2019-06-13 10:10' BETWEEN START_DATE_SERVER AND END_DATE_SERVER 
AND (  ( SOURCE = 0  AND START_TIME IS NULL AND END_TIME IS NULL ) 
	OR ( SOURCE = 0 AND (IF(TIME(START_DATE_SERVER) > TIME(END_DATE_SERVER),    IF(TIME('2019-06-13 10:10') < TIME(END_DATE_SERVER) OR (TIME('2019-06-13 10:10') > TIME(START_DATE_SERVER)),1,0),TIME('2019-06-13 10:10')BETWEEN TIME(START_DATE_SERVER) AND TIME(END_DATE_SERVER) ))  ) 
	OR SOURCE = 1 OR SOURCE = 2  ) ) 
AND RUN_SCHEDULE <='2019-06-13 10:10'
AND (IF(SUN = 0, IF(MON = 0, IF(TUE = 0, IF(WED = 0, IF(THU = 0, IF(FRI = 0, IF(SAT = 0, TRUE, FALSE), FALSE), FALSE), FALSE), FALSE), FALSE), FALSE) OR IF (FRI = 1, TRUE, FALSE)) 
-- AND SERVER_NAME= 'Ftraxsched4-7b15ce7c-fc8e-46aa' 
-- AND LOCKED= 1  
AND IF(START_TIME IS NOT NULL AND END_TIME IS NOT NULL , IF (TIME('2019-06-13 10:10') BETWEEN START_TIME AND END_TIME OR (NOT (time('2019-06-13 10:10') BETWEEN END_TIME AND START_TIME) AND START_TIME > END_TIME) , 1,0),1)  
ORDER BY RUN_SCHEDULE ASC, INTERVALS DESC 
LIMIT 100
